{% extends "base.html" %}

{% block title %}{{ season.competition.name }} {{ season.name }} Season Summary {% endblock %}
{% block metadescription %}{{ season.competition.name }} soccer stats with standings, results, lineups, goals, awards...{% endblock %}

{% block extrahead %}

<script type="text/javascript">
  $(document).ready(function (){
  $("div[tab='games']").load("{% url games_ajax_by_id %}?season={{ season.id }}");
  $("div[tab='stats']").load("{% url stats_ajax_by_id %}?season={{ season.id }}");
  });
</script>

{% endblock %}

{% block content %}



<h3>
{% if season.previous_season %}<a href="{% url season_detail season.competition.slug season.previous_season.slug %}">←</a>{% endif %}
{{ season }}
{% if season.next_season %}<a href="{% url season_detail season.competition.slug season.next_season.slug %}">→</a>{% endif %}
</h3>


<ul id="tabs"></ul>

<div id="tab_wrapper">


<div tab="summary">
{% include "templatetags/compact_standings.html" with standings=season.standing_set.all %}

<h3>Golden Boot: </h3>
<h3>Goals per game: {{ season.goals_per_game|floatformat }}</h3>
<h3>Average age: {{ season.average_age|floatformat:"2" }}</h3>
<h3>Average attendance: {{ average_attendance|floatformat }} ( {{ attenance_games_count }} games)</h3>

<h3>Top attendances</h3>
{% include "templatetags/top_attendance.html" with games=top_attendance_games %}

<h3>Bottom attendances</h3>
{% include "templatetags/top_attendance.html" with games=worst_attendance_games %}




<table>
<th><td>Goal leaders</td></th>

{% for stat in goal_leaders %}

<tr>
  <td>{{ stat.goals }}</td>
  {% if stat.player.slug %}
  <td><a href="{% url person_detail stat.player.slug %}">{{ stat.player }}</a></td>
  {% else %}
  <td>{{ stat.player }}</td>
  {% endif %}
    
</tr>
{% endfor %}




</table>



<table>

<th><td>Game leaders</td></th>
{% for stat in game_leaders %}
<tr>
  <td>{{ stat.games_played }}</td>
  {% if stat.player.slug %}
  <td><a href="{% url person_detail stat.player.slug %}">{{ stat.player }}</a></td>
  {% else %}
  <td>{{ stat.player }}</td>
  {% endif %}
</tr>
{% endfor %}
</table>




</div>



{% if season.standing_set.exists %}
<div tab="standings">
{% include "templatetags/standings.html" with standings=season.standing_set.all %}
</div>
{% endif %}



{% if stats %}
<div tab="stats">
</div>
{% endif %}


{% if season.awarditem_set.exists %}
<div tab="awards">
<table>
  <tr>
    <th>Award</th>
    <th>Winner</th>
  </tr>

  {% for a in season.awarditem_set.all %}
  <tr>
    <td><a href="{% url award_detail a.award.id %}">{{ a.award.name }}</a></td>
    <td><a href="{{ a.recipient.get_absolute_url }}">{{ a.recipient }}</a></td>
  </tr>
  {% endfor %}
</table>
</div>
{% endif %}


{% if season.game_set.exists %}
<div tab="games">
</div>
{% endif %}

{% comment %}
{% if testing %}
<div tab="added">
<table>
{% for stat in testing %}
<tr>
  {% if stat.player.slug %}
  <td><a href="{% url person_detail stat.player.slug %}">{{ stat.player }}</a></td>
  {% else %}
  <td>{{ stat.player }}</td>
  {% endif %}
</tr>
{% endfor %}
</table>
</div>
{% endif %}
{% endcomment %}

<div tab="graphs">

{% include "templatetags/nationality.html" with nstat=season.confederation_stats %}

{% include "templatetags/nationality.html" with nstat=season.nationality_stats %}

{{ known_minutes }} known minutes of {{ total_minutes }} total minutes
</div>


</div>
{% endblock %}
